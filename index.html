<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>手書きde暗算</title><meta name=description content=手書きde暗算は、手書きの暗算練習アプリです。小学生から大人まで楽しめます。><link rel=apple-touch-icon sizes=180x180 href=/tegaki-de-anzan/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/tegaki-de-anzan/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=48x48 href=/tegaki-de-anzan/favicon/favicon-48x48.png><link rel=manifest href=/tegaki-de-anzan/favicon/site.webmanifest><link rel=mask-icon href=/tegaki-de-anzan/favicon/safari-pinned-tab.svg color=#5bbad5><meta name=apple-mobile-web-app-title content=タイプde暗算><meta name=application-name content=タイプde暗算><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css><style>@font-face{font-family:aahub_light;font-style:normal;font-weight:400;url('https://marmooo.github.io/fonts/aahub_light.woff2') format('woff2'), url('https://marmooo.github.io/fonts/aahub_light.woff') format('woff'), url('https://marmooo.github.io/fonts/aahub_light.ttf') format('ttf'),}pre.aa{font-size:1rem;display:inline-block;text-align:left;line-height:1;font-family:aahub_light;white-space:pre;word-wrap:normal;padding:.5rem}#answerAA{font-size:.8rem}.nav-link{color:#99caff}.nav-link:hover{color:#cce4ff}footer{text-align:center;background:#f2f2f2;padding:1rem}a.footer{padding:.5rem}a.list{margin-right:.5rem;word-break:keep-all}.problem{margin:auto}.coll{text-align:left}.colr{text-align:center}@media(min-width:768px){.coll{text-align:right}.colr{text-align:left}}.edit{display:inline-block;text-align:center}.clear{margin-bottom:1rem}.colc{text-align:center}#gameStart,#gameEnd,#problem,#mofumofu,#problem{display:none}#answers{display:flex}#answers1,#answers2{padding:0}#answers1 table{font-size:.9rem;margin-left:auto;margin-right:.5rem}#answers2 table{font-size:.9rem;margin-right:auto;margin-left:.5rem}@media(min-width:360px){#answers1 table{margin-left:auto;margin-right:1rem}#answers2 table{margin-right:auto;margin-left:1rem}}.ans>.a{display:inline-block;width:1.5rem}.ans>.b{display:inline-block;width:1.5rem}.ans>.c{display:inline-block;width:1.5rem}.ans>.x{display:inline-block;width:1rem}.ans>.y{display:inline-block;width:1rem}.z{display:none;color:red;padding-left:.5rem;width:2.5rem}#age{margin-top:3rem;width:initial;margin:auto}#start{margin-top:1rem;margin-bottom:3rem}#end,#replay{margin-top:3rem;margin-bottom:3rem}#finalLap{font-size:2rem}#finalCorrect{font-size:2rem}#score{font-size:5rem}#counter{font-size:10rem;width:12rem;height:12rem;line-height:12rem;border-radius:50%;background:tomato;margin:auto}.num{font-size:3rem}@media(min-width:360px){.num{font-size:3.5rem}}#timer{position:fixed;bottom:0;right:0}</style></head><body><nav id=header class="navbar navbar-expand-sm navbar-dark bg-dark"><a class=navbar-brand href=/>手書きde暗算</a></nav><div class="container mx-auto py-3"><div id=gameStart class=text-center><div id=testContent><div id=countdown><div id=counter>3</div><pre id=countdownAA class=aa>
　 ￣ヽ、　　　_ノ￣￣￣￣￣￣￣￣￣￣￣
　 　　　｀'ｰ '´
　　　　　　○
　　　　　　　Ｏ　　　　始まるぞぉー！

　　　　　　　　　彡⌒ ミ
　　　　　　　　ヽ(´･ω･｀)ノ
　　　　　　　　　(＿＿＿)
        </pre></div><div id=problems></div><div id=gameEnd><button id=end type=button class="btn btn-primary btn-lg">クリックして採点する！</button><br><pre id=endAA class=aa>
　　　　彡 ⌒ ミ
. 　 　 （´・ω・；)　これで良いかな？
　　　 φ＿_⊂）
　　　| 9=ε-8 |
　　　|ε= 9-6 |
        </pre></div><div id=mofumofu><pre id=breakAA class=aa>
　　　　 　 　 　 彡⌒ ミ　　　　　＿
|;;;;;|￣￣~''-,._.,(´・ω・｀) 　r-^~.￣|;;;;;|
.|;;;;;| ∵　∴　． Ｕ^^^Ｕ　 ．． ∵ |;;;;;|
　i;;;;;;!　∴　 ∵　： ∵ ∴　 ． ∵ i;;;;;;!　おつかれー
　ヽ;;;ヽ　 ∵　．∵　∴　∵ 　． /;;;;/
　　 ＼;;;＼　∵．　∴　．　 ∵／;;／
　　　　＼;;;~'',-,,＿＿＿_,,-,,''~;;／
　　　　　　 '-'';,;;;;;;;;;;;;;;;;;;;;;;,;;-
        </pre><div class=jumbotron><div><span id=finalLap></span>秒でクリア！ 正答率: <span id=finalCorrect></span>/20</div><div>総合得点: <span id=score></span>/∞</div></div><div><h5>解答</h5><div id=answers-list class=row><div id=answers1 class=col><table><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z></table></div><div id=answers2 class=col><table><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z><tr><td class=a><td class=x><td class=b><td class=y><td class=c><td class=z></table></div></div></div><div><a href=/ id=replay role=button class="btn btn-primary btn-lg">もう1度プレイする！</a></div><pre id=endAA class=aa>
　　彡⌒ ミ
⊂(´・ω・｀) 　もっと練習するんだぜ？
　/　　 　,9m
　し―-J
        </pre></div><div id=problem class=problem><div class=row><div class="next col-sm coll num"><span class=a></span><span class=x></span><span class=b></span><span class=y></span><span class=c></span><span class=z></span></div><div class="col-sm colr"><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div style=clear:both></div></div></div></div></div><div><span id=timer class="btn btn-info">現在の時間: <span id=lap>0</span>秒</span></div></div><div id=testEnd></div><div id=introduction><div class=text-center><h5>暗算20問: 手書きで早解きゲーム</h5><br><pre id=topAA class=aa>
彡⌒ ミ　 　特訓ルームへようこそ！
( `･ω･)　　<b>ルールは簡単！</b>
/　∽ |　　　　早く解くほど高得点。
しー-Ｊ　　　　ただし計算ミスは減点だ。
      </pre><br><br></div><div class=text-center><p>まずは学年を指定して、難しさを調整しよう。指定したらさっそくゲームスタートだ！</p><select id=age class=form-control>
<option disabled>学年を選択
<option>小学1年
<option>小学2年
<option>小学3年
<option selected>小学4年
<option>小学5年
<option>小学6年
<option>中学生以上</select>
<button id=start type=button class="btn btn-primary btn-lg">クリックしてスタート！</button><div id=preview><p><b>ヒント</b>: 例えばこんな問題が出る。手書きの練習をしてみよう。
問題文をタップするとその問題へスクロールするから早く解けるよ。<div class=problem><div class=row><div class="next col-sm coll num">3＋4＝</div><div class="col-sm colr"><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div style=clear:both></div></div></div></div><div class=problem><div class=row><div class="next col-sm coll num">7×8＝</div><div class="col-sm colr"><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div class=edit><canvas width=105 height=140 style="border:1px solid"></canvas><br><button type=button class="clear btn btn-secondary btn-sm">書き直し</button></div><div style=clear:both></div></div></div></div></div><pre id=hintAA class=aa>
　　 .彡 ⌒ ミ 彡⌒ ミ
　　　(´・ω・) (・ω・｀)　早く解けるよねー
　　　U　　Ｕ) ( つと ﾉ
　 　┃彡⌒ ミ　彡⌒ミ
　　 ┃(　　´・) (・｀　　)　そだねー
　 　┻(　 　 ) 　(　　　ﾉ　　　 ┏
　　　　 `ｕ-ｕ'.　`ｕ-u' 　　　(￣￣）
　　　　　　　　　　　　　　　　.￣￣
      </pre></div></div></div><footer><div><a class=footer href=/>Home</a>
<a class=footer href=/>利用規約</a>
<a class=footer href=/>お問い合わせ</a></div><div class=text-muted>(c) 手書きde算数. All Rights Reserved.</div></footer><script src=https://marmooo.github.io/js/signature_pad.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/tensorflow/1.1.2/tf.min.js></script><script>function initSignaturePad(id){const problems=document.getElementById(id).getElementsByClassName('problem');for(var i=0;i<problems.length;i++){let signaturePads=[];const drawElements=problems[i].getElementsByTagName('CANVAS');for(var j=0;j<drawElements.length;j++){const signaturePad=new SignaturePad(drawElements[j],{minWidth:5,maxWidth:5,penColor:'white',backgroundColor:'black',});signaturePads.push(signaturePad);signaturePad.onEnd=function(){prediction(this.canvas);};}
const clearElement=problems[i].getElementsByClassName('clear');for(var j=0;j<signaturePads.length;j++){(function(signaturePad){clearElement[j].addEventListener('click',function(){signaturePad.clear();prediction(signaturePad.canvas);});}(signaturePads[j]));}
const nextElement=problems[i].getElementsByClassName('next')[0];if(nextElement){nextElement.addEventListener('click',function(){this.parentNode.parentNode.scrollIntoView(true);});}}}
function getLevels(level){switch(level){case 1:return[8,2,8,2,0,0,0,0];case 2:return[18,2,18,2,8,2,0,0];case 3:return[28,2,28,2,8,2,3,2];case 4:return[48,7,48,7,12,2,8,2];case 5:return[48,12,48,12,16,4,16,4];case 6:return[48,17,48,17,14,6,14,6];default:return[48,22,48,22,12,8,12,8];}}
function generateData(){var level=document.getElementById('age').selectedIndex;var levels=getLevels(level);for(var i=0;i<20;i++){var problem=document.getElementById('problem').cloneNode(true);var a_=problem.getElementsByClassName('a')[0];var b_=problem.getElementsByClassName('b')[0];var x_=problem.getElementsByClassName('x')[0];var y_=problem.getElementsByClassName('y')[0];var z_=problem.getElementsByClassName('z')[0];let a,b,c,x;if(level==1){var s=Math.floor(Math.random()*2);}else if(level==2){var s=Math.floor(Math.random()*3);}else{var s=Math.floor(Math.random()*4);}
switch(s){case 0:a=Math.floor(Math.random()*levels[0]+levels[1]);b=Math.floor(Math.random()*levels[0]+levels[1]);c=a+b;x='＋';break;case 1:a=Math.floor(Math.random()*levels[2]+levels[3]);b=Math.floor(Math.random()*(a-levels[3])+levels[3]);c=a-b;x='−';break;case 2:a=Math.floor(Math.random()*levels[4]+levels[5]);b=Math.floor(Math.random()*levels[4]+levels[5]);c=a*b;x='×';break;case 3:b=Math.floor(Math.random()*levels[6]+levels[7]);c=Math.floor(Math.random()*levels[6]+levels[7]);a=b*c;x='÷';break;default:console.log('error');}
var vals=[a,b,c];a_.innerText=vals[0];b_.innerText=vals[1];x_.innerText=x;y_.innerText='＝';z_.innerText=c;problem.removeAttribute('id');document.getElementById('problems').appendChild(problem);}
initSignaturePad('problems');}
function generateAnswer(){let correctNum=0;const answers1=document.getElementById('answers1').getElementsByTagName('TABLE')[0];const answers2=document.getElementById('answers2').getElementsByTagName('TABLE')[0];const problems=document.getElementById('problems').getElementsByClassName('problem');for(var i=0;i<problems.length;i++){const answer=problems[i].getElementsByClassName('next')[0].cloneNode(true);const a=answer.getElementsByClassName('a')[0].innerText;const b=answer.getElementsByClassName('b')[0].innerText;const c=answer.getElementsByClassName('c')[0].innerText;const x=answer.getElementsByClassName('x')[0].innerText;const y=answer.getElementsByClassName('y')[0].innerText;let z=answer.getElementsByClassName('z')[0].innerText;if(z==c){z='◯';correctNum+=1}else{z='× '+z;}
if(i<problems.length/2){var tds=answers1.getElementsByTagName('TR')[i].children;}else{var tds=answers2.getElementsByTagName('TR')[i-10].children;}
tds[0].innerText=a;tds[1].innerText=x;tds[2].innerText=b;tds[3].innerText=y;tds[4].innerText=c;tds[5].innerText=z;tds[5].style.display='initial';}
document.getElementById('problems').style.display='none';document.getElementById('gameEnd').style.display='none';document.getElementById('timer').style.display='none';return correctNum;}
function getImageData(drawElement){const inputWidth=inputHeight=28;const tmpCanvas=document.createElement('canvas').getContext('2d');tmpCanvas.drawImage(drawElement,0,0,inputWidth,inputHeight);let imageData=tmpCanvas.getImageData(0,0,inputWidth,inputHeight);return imageData;}
function getAccuracyScores(imageData){const score=tf.tidy(()=>{const channels=1;let input=tf.browser.fromPixels(imageData,channels);input=tf.cast(input,'float32').div(tf.scalar(255));input=input.expandDims();return model.predict(input).dataSync();});return score;}
function prediction(drawElement){const drawElements=drawElement.parentNode.parentNode.getElementsByTagName('CANVAS');const c=drawElement.parentNode.parentNode.parentNode.getElementsByClassName('c')[0];let result='';for(var i=0;i<drawElements.length;i++){const imageData=getImageData(drawElements[i]);let sum=0;let data=imageData.data;for(var j=0;j<data.length;j+=4){sum+=data[j]+data[j+1]+data[j+2];}
if(sum!=0){const accuracyScores=getAccuracyScores(imageData);const maxAccuracy=accuracyScores.indexOf(Math.max.apply(null,accuracyScores));if(accuracyScores[maxAccuracy]>0.5){result+=maxAccuracy.toString();}}}
c.innerText=result;}
let model;tf.loadLayersModel('/tegaki-de-anzan/model/model.json').then(pretrainedModel=>{model=pretrainedModel;});initSignaturePad('preview');let playing=true;document.getElementById('end').addEventListener('click',function(){playing=false;const correctNum=generateAnswer();const lap=parseFloat(document.getElementById('lap').innerText);const level=document.getElementById('age').selectedIndex;document.getElementById('finalLap').innerText=Math.round(lap);document.getElementById('finalCorrect').innerText=correctNum;document.getElementById('score').innerText=Math.round(1/(lap+(20-correctNum)*5)*correctNum*(level+10)*1000);const mofumofu=document.getElementById('mofumofu');mofumofu.style.display='block';mofumofu.scrollIntoView(true);});let introduction=document.getElementById('introduction');let gameStart=document.getElementById('gameStart');document.getElementById('start').addEventListener('click',function(){introduction.style.display='none';gameStart.style.display='initial';var timer=setInterval(function(){var counter=document.getElementById('counter');var colors=['skyblue','greenyellow','violet','tomato'];if(parseInt(counter.innerText)>1){var t=parseInt(counter.innerText)-1;counter.style.backgroundColor=colors[t];counter.innerText=t;}else{clearTimeout(timer);counter.style.fontSize='5rem';counter.style.backgroundColor=colors[0];counter.innerText='GO!';var testTimer=setInterval(function(){clearTimeout(testTimer);document.getElementById('countdown').style.display='none';counter.innerText=4;counter.style.backgroundColor=colors[4];generateData();gameEnd.style.display='initial';const startTime=Date.now();const lap=document.getElementById('lap');var lapTimer=setInterval(function(){if(playing){lap.innerText=Math.round((Date.now()-startTime)/1000);}else{clearTimeout(lapTimer);}},100);},1000);}},1000);});</script></body></html>